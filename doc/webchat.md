微信端控制逻辑
---

### 通用处理

1. 验证消息合法性， 如果通不过验证，返回 `403 Forbidden`

2. 解析POST请求发送过来的`XML`流， 得到Python中的消息对象 `WebchatMessage`

### 事件信息

1. subscribe : 关注事件
    - 用户人数 `+1`
    - 欢迎信息 welcome_message
    - 新用户 ? `+1`

2. unsubscribe : 退订事件
    - 用户人数 `+1`

3. 订餐按钮
    - 从消息对象中取出用户ID : `message.source`, 将其编码入相应URL
    - 制作图文信息, 发送给用户
    - 用户点击链接进入饮食中心订餐页面， 系统进行URL解编码, 获取用户微信openid

4. 最新活动
    - 获取最近几条活动的摘要，制作图文信息，发送给用户.

### 文本信息

1. 针对用户

    考虑建设简单的帮助系统，通过简单的正则匹配，返回几个静态的文本

2. 针对工作人员

    主要解决管理员获取当日订单的需求


### 其他

其他消息类型(如语音、图片等)视为无效输入, 系统返回简单的帮助信息 `help_message`
